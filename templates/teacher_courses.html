{% extends 'base.html' %}
{% block title %}{{ teacher.name }} - Courses{% endblock %}

{% block content %}
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>

<style>
    .glass-button {
        background: white;
        color: #8e2de2;
        border: 2px solid #8e2de2;
        border-radius: 12px;
        padding: 10px 20px;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.08), 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .glass-button:hover {
        background: #8e2de2;
        color: white;
        border-color: #8e2de2;
        box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.1), 0 6px 16px rgba(0, 0, 0, 0.3);
    }

    .teacher-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
    }

    table.table {
        border-radius: 10px;
        overflow: hidden;
        background-color: #fff;
    }

    thead.table-dark th {
        color: #fff;
        border: none;
    }

    table td, table th {
        vertical-align: middle;
        text-align: center;
    }

    h2 {
        font-weight: 600;
        color: #000000;
        text-align: center;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <a href="{% url 'teacher_list' %}" class="glass-button">‚Üê Back to Teachers</a>
    <h2 class="mb-0">TEACHER COURSE MANAGEMENT</h2>
</div>

<!-- Teacher Info Card -->
<div class="teacher-info">
    <div class="row align-items-center">
        <div class="col-md-2 text-center">
            <div class="teacher-avatar" style="width: 80px; height: 80px; border-radius: 50%; overflow: hidden; border: 3px solid white; margin: 0 auto;">
                {% if teacher.profile_picture %}
                    <img src="{{ teacher.profile_picture.url }}" alt="{{ teacher.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                    <div style="background: rgba(255,255,255,0.3); width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                        <i class="bi bi-person-fill" style="font-size: 2rem;"></i>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="col-md-10">
            <h3 class="mb-2">{{ teacher.name }}</h3>
            <div class="row">
                <div class="col-md-4"><strong>Department:</strong> {{ teacher.dept.dept_name }}</div>
                <div class="col-md-4"><strong>Designation:</strong> {{ teacher.designation }}</div>
                <div class="col-md-4"><strong>Feedback Status:</strong> 
                    {% if teacher.fb_active %}
                        <span class="badge bg-success">Active</span>
                    {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Courses Table -->
<div class="card shadow">
    <div class="card-header bg-dark text-white">
        <h5 class="mb-0"><i class="bi bi-book"></i> Active Courses (From Active Batches)</h5>
    </div>
    <div class="card-body">
        {% if teacher_batches %}
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>SI.No</th>
                        <th>Course Code</th>
                        <th>Course Name</th>
                        <th>Batch</th>
                        <th>Department</th>
                        <th>Feedback Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for teacher_batch in teacher_batches %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><strong>{{ teacher_batch.course.code }}</strong></td>
                        <td>{{ teacher_batch.course.name }}</td>
                        <td>{{ teacher_batch.batch.acad_year }} - {{ teacher_batch.batch.part }}</td>
                        <td>{{ teacher_batch.department.dept_name }}</td>
                        <td>
                            {% if teacher_batch.is_active_for_feedback %}
                                <span class="badge bg-success">Active for Feedback</span>
                            {% else %}
                                <span class="badge bg-secondary">Inactive for Feedback</span>
                            {% endif %}
                        </td>
                        <td>
                            <form action="{% url 'toggle_teacher_course_feedback' teacher_batch.teacher_batch_id %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" 
                                    class="btn btn-sm {% if teacher_batch.is_active_for_feedback %}btn-warning{% else %}btn-success{% endif %}"
                                    title="{% if teacher_batch.is_active_for_feedback %}Deactivate{% else %}Activate{% endif %} Feedback">
                                    {% if teacher_batch.is_active_for_feedback %}
                                        <i class="bi bi-pause-circle"></i> Deactivate Feedback
                                    {% else %}
                                        <i class="bi bi-play-circle"></i> Activate Feedback
                                    {% endif %}
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="text-center py-4">
                <i class="bi bi-book" style="font-size: 3rem; color: #ccc;"></i>
                <h5 class="mt-3 text-muted">No Active Courses Found</h5>
                <p class="text-muted">This teacher has no courses from active batches. Please activate batches first in Course Management.</p>
                <a href="{% url 'course_list' %}" class="glass-button">Go to Course Management</a>
            </div>
        {% endif %}
    </div>
</div>

<!-- Info Card -->
<div class="alert alert-info mt-4">
    <h6><i class="bi bi-info-circle"></i> How it works:</h6>
    <ol class="mb-0">
        <li><strong>Batch Activation:</strong> First, activate batches in Course Management</li>
        <li><strong>Course Activation:</strong> Then activate specific courses for this teacher to enable feedback</li>
        <li><strong>Student Feedback:</strong> Students can then give feedback for the activated teacher-course combinations</li>
    </ol>
</div>

{% endblock %}